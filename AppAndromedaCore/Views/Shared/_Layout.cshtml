<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - ANDROMEDA 2.0</title>
    @Styles.Render("~/Content/css")
    @Styles.Render("~/bundles/AdminLT")
    @Scripts.Render("~/bundles/modernizr")
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="~/Content/AdminLT/plugins/fontawesome-free/css/all.min.css">

    <!-- Bootstrap4 Duallistbox -->
    @* <link rel="stylesheet" href="~/Content/AdminLT/plugins/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css">*@

    <style>
        textarea {
            resize: both;
            outline: none;
        }

        #count_message {
            border-radius: 9px;
            background-color: gainsboro;
            margin-top: -20px;
            margin-right: 5px;
        }
    </style>


    @*<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">*@
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,400i,700" rel="stylesheet">
</head>
<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed sidebar-collapse text-sm">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-dark navbar-lightblue" style="padding-bottom: 1px; padding-top: 1px;">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                @*<li class="nav-item d-none d-sm-inline-block">
                            <a href="index3.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item d-none d-sm-inline-block">
                        <a href="#" class="nav-link">Contact</a>
                    </li>*@
            </ul>

            <!-- SEARCH FORM -->
            <form class="form-inline ml-3">
                @*<div class="input-group input-group-sm">
                        <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                        <div class="input-group-append">
                            <button class="btn btn-navbar" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>*@
                <h3 style="color:#ffffff">ANDRÓMEDA 2.0</h3>
            </form>

            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Notifications Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="fas fa-cog"></i>
                        <span class="badge badge-danger navbar-badge"><span class="fas fa-bell" /></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <span class="dropdown-item dropdown-header">Configuración</span>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" onclick="Opencambio()">
                            <i class="fas fa-key mr-2"></i> Cambio de contraseña
                            @*<span class="float-right text-muted text-sm">3 mins</span>*@
                        </a>
                        @*<div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item">
                                <i class="fas fa-users mr-2"></i> 8 contactos creados
                                <span class="float-right text-muted text-sm">12 horas</span>
                            </a>*@
                        <div class="dropdown-divider"></div>
                        <a href="/Home/LogOut" class="dropdown-item">
                            <i class="fas fa-sign-out-alt mr-2"></i> Salir
                        </a>
                        @*<div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item dropdown-footer">Ver todas </a>*@
                    </div>
                </li>
                <li>
                    @*<img src="~/Content/AdminLT/dist/img/logoheader.png" class="logoheader" alt="">*@
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4 ">
            <!-- Brand Logo -->
            <a href="/Home/Dashboard" class="brand-link" style=" border-top-right-radius: 17px; background: linear-gradient(to right, rgba(73,155,234,1) -7%, rgba(59,89,152,1) 8%, rgba(59,89,152,1) 98%, rgba(59,89,152,0.5) 125%) !important; ">
                <img src="~/Content/AdminLT/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                     style="opacity: .8">
                <span class="brand-text font-weight-light">Andrómeda</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar " style="background: linear-gradient(to right, rgba(73,155,234,1) -7%, rgba(59,89,152,1) 8%, rgba(59,89,152,1) 98%, rgba(59,89,152,0.5) 125%) !important; ">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="~/Content/AdminLT/dist/img/foto.jpg" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block"><label id="usurioLog">--</label></a>
                    </div>
                    @*<div class="collapse" id="loggedinMenu">*@
                    <div>
                        <ul class="nav nav-aside mg-b-0">
                            <li class="nav-item"><a href="http://andromeda:9185/Home/Dashboard" class="nav-link"><i class="fas fa-sign-out-alt"></i><span>Salir</span></a></li>
                        </ul>
                    </div>
                </div>

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column " data-widget="treeview" role="menu" data-accordion="false">
                        <li>
                            <a href="/Home/Dashboard" class="nav-link active" style="color: #ffffff; background-color: #3B5998;">
                                <i class="nav-icon fas fa-home fa-2x"></i>
                                <p>
                                    Inicio
                                    <i class="right fas fa-angle-left"></i>
                                </p>
                            </a>
                        </li>
                        <li class="clearfix">&nbsp;</li>
                        <li class="nav-header">AYUDA</li>
                        <li class="nav-item">
                            <a href="/Home/PDFPartialView" class="nav-link">
                                <i class="fa fa-question-circle fa-2x"></i>
                                <p>
                                    Guía de Usuario
                                    <span class="right badge badge-danger">A</span>
                                </p>
                            </a>
                        </li>
                        <li class="clearfix">&nbsp;</li>
                        <li class="nav-header">
                            <h6 style="font-size: small;">V @typeof(AppAndromedaCore.MvcApplication).Assembly.GetName().Version</h6>
                        </li>
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="container-fluid">
                    @*<div class="row mb-2">
                            <div class="col-sm-6">
                                <h1 class="m-0 text-dark">Dashboard v2</h1>
                            </div>
                            <div class="col-sm">
                                <ol class="breadcrumb float-sm-right">
                                    <li class="breadcrumb-item"><a href="~/Home/Dashboard">Inicio</a></li>
                                    <li class="breadcrumb-item active">...</li>
                                </ol>
                            </div>
                        </div>*@
                </div><!-- /.container-fluid -->
            </div>
            <!-- /.content-header -->
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    @RenderBody()
                </div><!--/. container-fluid -->
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
        <!-- Main Footer -->
        <footer class="main-footer text-sm" style="height:37px">
            <div class="float-right d-none d-sm-inline-block">
                @*<b>Version</b> 1.0.1.1*@
                <h5> Proyecto Andrómeda - CTIC 2022</h5>
            </div>
        </footer>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="ContrasenaModal" tabindex="-1" role="dialog" aria-labelledby="contrasenaModalLabel" aria-hidden="true" style="display:none">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="personaModalLabel">Cambio de contraseña</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="modal-content">
                        <div class="form-group col-sm-9">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text"><i class="fas fa-key mr-2"></i></div>
                                </div>
                                <input type="password" class="form-control" id="PWDAnterior" name="Contrasena anterior" value="" placeholder="Contraseña Actual" />
                            </div>
                            @*@Html.ValidationMessageFor(model => model.Nombre)*@
                        </div>
                        <div class="form-group col-sm-9">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text"><i class="fas fa-sync fa-spin mr-2"></i></div>
                                </div>
                                <input type="password" class="form-control" id="PWDNueva" name="Contrasena nueva" value="" placeholder="Nuevea Constrseña" />
                            </div>
                            @*@Html.ValidationMessageFor(model => model.Nombre)*@
                        </div>
                        <!--<div class="form-group col-sm-9">
                            <h6>Contraseña anterior:</h6>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text"><i class="fas fa-key mr-2"></i></div>
                                </div>
                                <input type="text" class="form-control" id="PWDAnterior" name="Nombre" value="" />
                            </div>-->
                        @*@Html.ValidationMessageFor(model => model.Nombre)*@
                        <!--</div>-->
                    </div>
                </div>
                <div class="modal-footer mr-auto">
                    @*<button type="button" class="btn btn-danger fa fa-trash-alt" data-dismiss="modal">Cancelar</button>*@
                    <button id="guardar" type="button" class="btn btn-success btn-mae-grdr fa fa-check-circle" onclick="GuardarCambioContrasena()">&nbsp;Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
    //obtener el usuario logueado
     document.getElementById('usurioLog').innerHTML = '@Session["UsuarioAD"]';
     //document.getElementById('usurioLog').innerHTML = '---';

    //$(document).ready(function () {

    //    });
    </script>

    @if (TempData["Message"] != null)
    {
        <script type="text/javascript">
        window.onload = function () {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 5000
            });

            Toast.fire({
                icon: '@TempData["AlertType"]',
                title: '@TempData["Message"]'
            });

         };
        </script>
    }
    @if (ViewBag.Message != null)
    {
        <script type="text/javascript">
        window.onload = function () {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 8000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });

            Toast.fire({
                icon: '@ViewBag.AlertType',
                title: '@ViewBag.Message'
            });

         };
        </script>
    }

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    @*@Scripts.Render("~/bundles/bootstrap")*@
    @Scripts.Render("~/bundles/AdminLT/plugins")
    @Scripts.Render("~/bundles/AdminLT/js")
    @RenderSection("scripts", required: false)


    <!-- daterangepicker -->
    <script src="~/Content/AdminLT/plugins/jquery-ui/jquery-ui.js"></script>
    <script src="~/Content/AdminLT/plugins/daterangepicker/daterangepicker.js"></script>

    @*<script src="~/Content/AdminLT/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>*@

    <script type="text/javascript">
        //Initialize Select2 Elements
        $('.select2').select2()

        //Initialize Select2 Elements
        $('.select2bs4').select2({
            theme: 'bootstrap4'
        })


       //obtener el usuario logueado
     document.getElementById('usurioLog').innerHTML = '@Session["UsuarioAD"]';
        $(document).ready(function () {

            $('[data-toggle="tooltip"]').tooltip({
                selector: true,
                title: function () {
                    return $(this).attr('href');
                }
            });
           // $.bsCustomFileInput.init();

            $.datepicker.setDefaults($.datepicker.regional["es"] = {
                dateFormat: 'dd/mm/yy',
                dayNamesMin: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sá'],
                monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                prevText: '<Ant',
                nextText: 'Sig> ',
                currentText: 'Hoy',
                firstDay: 1,
                showMonthAfterYear: false,
                changeMonth: true,
                changeYear: true,
                isRTL: false,
            });
            $("#FechaReporte").datepicker();
            $("#FechaRecibido").datepicker();

            var text_max = 3950;
            $('#count_message').html('0 / ' + text_max);

            $('#Situacion').keyup(function () {
                var text_length = $('#Situacion').val().length;
                var text_remaining = text_max - text_length;

                $('#count_message').html(text_length + ' / ' + text_max);
            });
            //Bootstrap Duallistbox
            $('.duallistbox').bootstrapDualListbox();
          /*  $("#wizard").steps();*/

            bsCustomFileInput.init();

        });

    function Opencambio() {
        $('#ContrasenaModal').modal('show');
    };

    function GuardarCambioContrasena() {

        var Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 5000 });

        if ($("#PWDAnterior").val() === $("#PWDNueva").val()) {
            Toast.fire({
                type: 'success',
                icon: "error",
                title: 'La nueva contraseña debe ser diferente a la actual.',
                customClass: { popup: 'adjust', icon: 'error' }
            });
            return;
        }

        if ($("#PWDAnterior").val() === "") {
            Toast.fire({
                type: 'success',
                icon: "info",
                title: ' Ingrese la contraseña actual',
                customClass: { popup: 'adjust', icon: 'info' }
            });
            return;
        }
        if ($("#PWDNueva").val() === "") {
            Toast.fire({
                type: 'success',
                icon: "info",
                title: ' Debe ingresar la nueva contraseña',
                customClass: { popup: 'adjust', icon: 'info' }
            });
            return;
        }
        if ($("#PWDNueva").val().length > 20) {
            Toast.fire({
                type: 'success',
                icon: "warning",
                title: 'La nueva contraseña debe contener maximo 20 caracteres.',
                customClass: { popup: 'adjust', icon: 'warning' }
            });
            return;
        }
        var objPwd = {
            pwdAnterior: $("#PWDAnterior").val(),
            pwdNuevo: $("#PWDNueva").val()
        };
        var jPwds = JSON.stringify(objPwd);

        $.ajax({
                url: '@Url.Action("CambioPWD", "Home")',
                data: {
                    objpwds: jPwds
                },
                method: "GET",
                dataType: "text",
                async: true,
                beforeSend: function () {
                },
                success: function (result) {

                    switch (result) {
                        case "success":
                            window.location.href = "/Home/Dashboard";
                            break;
                        case "errorgrabando":
                            Toast.fire({
                                type: 'success',
                                icon: "error",
                                title: ' No es posible actualizar su contraseña.',
                                customClass: { popup: 'adjust', icon: 'error' }
                            });

                            break;
                        case "errorsesion":
                            window.location.href = "/Home/LogIn";
                            break;
                    }
                },
                error: function () {
                    window.location.href = "/Home/LogIn";
                }
            });
    };


    </script>

</body>
</html>